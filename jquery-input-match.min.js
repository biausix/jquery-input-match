!function($){function init(a){current_object=objects[a],$(".input-match-box").length>0&&($(".input-match-box").remove(),$(".input-match-box li").removeClass("on")),current_object.on_match_box=!1,current_object.input_queue=[],current_object.input_queue_length=0,current_object.html="",current_object.current_match_item_position="",current_object.select_item_position=""}function getCurrentObject(a){current_object=objects[a]}function isArray(a){return Array.isArray?Array.isArray(a):"[object Array]"===Object.prototype.toString.call(a)}function currentPath(a){for(var c,b=document.scripts,d=b.length;d>0;d--)b[d-1].src.indexOf(a)>-1&&(c=b[d-1].src.substring(0,b[d-1].src.lastIndexOf("/")+1));return c}function datasCheck(a){if(isArray(a)){for(i in a)if(void 0==a[i].text||void 0==a[i].value)return console.log("\u6570\u636e\u683c\u5f0f\u9519\u8bef"),!1;return a}return console.log("\u6570\u636e\u683c\u5f0f\u9519\u8bef"),!1}$.fn.inputMatch=function(a){count++,objects.push(this);var b=count,c={skin:"default",mustSelect:!1,maxLength:15,moreDataTip:"",timeout:300,matchOnFocus:!1,asParam:!1,match:!0,repeatRequest:!1,fillRightNow:!1};if(void 0!=a.data&&void 0!=a.url)return console.log("data\u6216url\u81f3\u5c11\u586b1\u4e2a"),!1;var d=[];if(void 0!=a.data&&(d=datasCheck(a.data),d===!1))return!1;if(void 0==a.timeout)var e=c.timeout;else var e=parseInt(a.timeout),e=isNaN(e)?c.timeout:e;if(void 0!=a.data&&(e=0),void 0==a.maxLength)var f=c.maxLength;else var f=parseInt(a.maxLength),f=isNaN(f)?c.maxLength:f;var g=void 0==a.moreDataTip?c.moreDataTip:a.moreDataTip,h=void 0==a.showOnFocus||a.showOnFocus!==!1&&a.showOnFocus!==!0?c.showOnFocus:a.showOnFocus,i=void 0==a.mustSelect||a.mustSelect!==!1&&a.mustSelect!==!0?c.mustSelect:a.mustSelect,j=void 0==a.asParam||a.asParam!==!1&&a.asParam!==!0?c.asParam:a.asParam,k=j?a.paramName:"",l=void 0==a.match||a.match!==!1&&a.match!==!0?c.match:a.match,m=void 0==a.matchOnFocus||a.matchOnFocus!==!1&&a.matchOnFocus!==!0?l:a.matchOnFocus,n=void 0==a.repeatRequest||a.repeatRequest!==!1&&a.repeatRequest!==!0?c.repeatRequest:a.repeatRequest,o=void 0!=a.selectCallback&&""!=a.selectCallback?a.selectCallback:"",p=[],q=!1,r=!1,s=0,t=0,u=this;this.on_match_box=!1,this.html="",this.input_queue_length=0,this.input_queue=[],this.current_match_item_position="",this.select_item_position="",this.fillRightNow=void 0==a.fillRightNow||a.fillRightNow!==!1&&a.fillRightNow!==!0?c.fillRightNow:a.fillRightNow;for(var v=void 0==a.skin?"default":a.skin,w=currentPath("jquery-input-match.min.js")+"themes/"+v+".css",x=!0,y=0;y<$("head link").length;y++)if(void 0!=$("head link").eq(y).attr("input-match-skin")&&$("head link").eq(y).attr("input-match-skin")==v){x=!1;break}x&&$("head").append("<link rel='stylesheet' input-match-skin='"+v+"' type='text/css' href='"+w+"'>");var z=v+"-input-match-box",A=function(){var a=u.val();for(y in d)if(a==d[y].text)return!0;return!1},B={},C=function(){var b=void 0==u.input_queue[u.input_queue.length-1]?"":u.input_queue[u.input_queue.length-1];return j&&""!=k?(B[k]=b,escape(a.url+k+b)):escape(a.url)},D=function(){u.input_queue_length=u.input_queue.length;var b=C();void 0==a.data?void 0!=a.url&&(n||!n&&void 0==p[b]?(t=1,$.getJSON(a.url,B,function(a){if(t=0,0!=u.input_queue.length&&q){var c=datasCheck(a);c!==!1&&(d=c,p[b]=d,G())}})):(d=p[b],G())):G()},E=function(){init(b);var a=f<d.length?f:d.length,c=0,e=u.val(),i=!1;for(y in d){if(!(a>c)){i=!0;break}var j=d[y];r&&h?m&&""!=e?-1!==j.text.indexOf(e)&&(F(j,c),c++):(F(j,c),c++):l&&""!=e?-1!==j.text.indexOf(e)&&(F(j,c),c++):(F(j,c),c++)}if(i&&""!=g&&(u.html=u.html+"<li more-data-tip='1'>"+g+"</li>"),""!=u.html){var k=u.offset(),n=k.left,o=k.top+u.outerHeight()+5;u.html="<ul id='"+z+"' class='input-match-box' onmouseleave='moveOnInputMatchBox("+b+",0)' onmouseenter='moveOnInputMatchBox("+b+",1)' style='position:absolute;top:"+o+"px;left:"+n+"px'>"+u.html+"</ul>",$("body").append(u.html)}r=!1},F=function(a,c){var d=u.val();if(d==a.text&&""===u.current_match_item_position){var e='class="on"';u.current_match_item_position=u.select_item_position=c}else var e="";var f=0==c?'style="border:none"':"";u.html=u.html+"<li "+e+' onclick="inputMatchItemSelect('+b+",'"+a.value+"','"+a.text+"','"+o+'\')" onmouseover="moveOverInputMatchItem('+b+',$(this))" value-v="'+a.value+'" '+f+">"+a.text+"</li>"},G=function(){if(e>0){var b=C();if(void 0!=a.data||void 0==a.url||n||void 0==p[b]){var c=(new Date).getTime();c-s>=e?H():setTimeout(function(){G()},50)}else d=p[b],E()}else H()},H=function(){u.input_queue.length>u.input_queue_length?1==t?setTimeout(function(){G()},50):D():E()};this.keydown(function(a){return 13==a.keyCode?(a.preventDefault(),a.stopPropagation(),!1):void 0}),this.keyup(function(c){if(13==c.keyCode)""!==u.select_item_position&&inputMatchItemSelect(b,$(".input-match-box li").eq(u.select_item_position).attr("value-v"),$(".input-match-box li").eq(u.select_item_position).text(),o);else if(38==c.keyCode||40==c.keyCode)moveSelectInputMatchItem(b,c.keyCode);else if($(".input-match-box").length>0&&$(".input-match-box").hide(),s=(new Date).getTime(),void 0!=a.data)u.input_queue.push(u.val()),1==u.input_queue.length&&G();else if(void 0!=a.url&&""!=a.url)if(u.input_queue.push(u.val()),1==u.input_queue.length)G();else{var e=C();void 0!=a.data||void 0==a.url||n||void 0==p[e]||(d=p[e],E())}return c.preventDefault(),c.stopPropagation(),!1}),this.focus(function(b){r=!0,q=!0,h&&(void 0!=a.data?(u.input_queue.push(u.val()),G()):void 0!=a.url&&""!=a.url&&(u.input_queue.push(u.val()),G()))}),this.blur(function(a){q=!1,u.on_match_box||(i&&(d.length>0&&A()||u.val("")),init(b))})};var count=-1,objects=[],current_object="";window.moveSelectInputMatchItem=function(a,b){if(getCurrentObject(a),$(".input-match-box").length>0&&(38==b||40==b)){var d=$(".input-match-box li").length-1,e=""===current_object.select_item_position?0:38==b?current_object.select_item_position-1:current_object.select_item_position+1;console.log($(".input-match-box li").eq(e).attr("more-data-tip")),void 0==$(".input-match-box li").eq(e).attr("more-data-tip")&&(e=0>e?0:e>d?d:e,moveOverInputMatchItem(a,$(".input-match-box li").eq(e)))}},window.moveOnInputMatchBox=function(a,b){getCurrentObject(a),1==b?current_object.on_match_box=!0:(current_object.on_match_box=!1,current_object.fillRightNow||(current_object.select_item_position=current_object.current_match_item_position,$(".input-match-box li").removeClass("on"),""!==current_object.current_match_item_position&&$(".input-match-box li").eq(current_object.current_match_item_position).addClass("on")))},window.moveOverInputMatchItem=function(a,b){getCurrentObject(a),$(".input-match-box li").removeClass("on"),b.addClass("on"),current_object.select_item_position=$(".input-match-box li").index(b),current_object.fillRightNow&&(current_object.current_match_item_position=current_object.select_item_position,current_object.val(b.text()))},window.inputMatchItemSelect=function(obj_count,value,text,callback){getCurrentObject(obj_count),current_object.val(text),init(obj_count),current_object.blur(),""!=callback&&eval(callback+"('"+value+"','"+text+"')")}}(jQuery);