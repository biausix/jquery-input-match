!function($){function init(a){current_object=objects[a],$(".input-match-box").length>0&&($(".input-match-box").remove(),$(".input-match-box li").removeClass("on")),current_object.on_match_box=!1,current_object.input_queue=[],current_object.input_queue_length=0,current_object.html="",current_object.current_match_item_position="",current_object.select_item_position=""}function getCurrentObject(a){current_object=objects[a]}function isArray(a){return Array.isArray?Array.isArray(a):"[object Array]"===Object.prototype.toString.call(a)}function currentPath(a){for(var c,b=document.scripts,d=b.length;d>0;d--)b[d-1].src.indexOf(a)>-1&&(c=b[d-1].src.substring(0,b[d-1].src.lastIndexOf("/")+1));return c}function datasCheck(a){if(isArray(a)){for(i in a)if(void 0==a[i].text||void 0==a[i].value)return console.log("\u6570\u636e\u683c\u5f0f\u9519\u8bef"),!1;return a}return console.log("\u6570\u636e\u683c\u5f0f\u9519\u8bef"),!1}$.fn.inputMatch=function(a){count++,objects.push(this);var b=count,c="jquery-input-match.min.js",d={skin:"default",mustSelect:!1,maxLength:15,moreDataTip:"",timeout:300,matchOnFocus:!1,asParam:!1,match:!0,repeatRequest:!1,fillRightNow:!1};if(void 0!=a.data&&void 0!=a.url)return console.log("data\u6216url\u81f3\u5c11\u586b1\u4e2a"),!1;var e=[];if(void 0!=a.data&&(e=datasCheck(a.data),e===!1))return!1;if(void 0==a.timeout)var f=d.timeout;else var f=parseInt(a.timeout),f=isNaN(f)?d.timeout:f;if(void 0!=a.data&&(f=0),void 0==a.maxLength)var g=d.maxLength;else var g=parseInt(a.maxLength),g=isNaN(g)?d.maxLength:g;var h=void 0==a.moreDataTip?d.moreDataTip:a.moreDataTip,i=void 0==a.showOnFocus||a.showOnFocus!==!1&&a.showOnFocus!==!0?d.showOnFocus:a.showOnFocus,j=void 0==a.mustSelect||a.mustSelect!==!1&&a.mustSelect!==!0?d.mustSelect:a.mustSelect,k=void 0==a.asParam||a.asParam!==!1&&a.asParam!==!0?d.asParam:a.asParam,l=k?a.paramName:"",m=void 0==a.match||a.match!==!1&&a.match!==!0?d.match:a.match,n=void 0==a.matchOnFocus||a.matchOnFocus!==!1&&a.matchOnFocus!==!0?m:a.matchOnFocus,o=void 0==a.repeatRequest||a.repeatRequest!==!1&&a.repeatRequest!==!0?d.repeatRequest:a.repeatRequest,p=void 0!=a.selectCallback&&""!=a.selectCallback?a.selectCallback:"",q=[],r=!1,s=!1,t=0,u=0,v=this;this.on_match_box=!1,this.html="",this.input_queue_length=0,this.input_queue=[],this.current_match_item_position="",this.select_item_position="",this.fillRightNow=void 0==a.fillRightNow||a.fillRightNow!==!1&&a.fillRightNow!==!0?d.fillRightNow:a.fillRightNow;for(var w=void 0==a.skin?"default":a.skin,x=currentPath(c)+"themes/"+w+".css",y=!0,z=0;z<$("head link").length;z++)if(void 0!=$("head link").eq(z).attr("input-match-skin")&&$("head link").eq(z).attr("input-match-skin")==w){y=!1;break}y&&$("head").append("<link rel='stylesheet' input-match-skin='"+w+"' type='text/css' href='"+x+"'>");var A=w+"-input-match-box",B=function(){var a=v.val();for(z in e)if(a==e[z].text)return!0;return!1},C={},D=function(){var b=void 0==v.input_queue[v.input_queue.length-1]?"":v.input_queue[v.input_queue.length-1];return k&&""!=l?(C[l]=b,escape(a.url+l+b)):escape(a.url)},E=function(){v.input_queue_length=v.input_queue.length;var b=D();void 0==a.data?void 0!=a.url&&(o||!o&&void 0==q[b]?(u=1,$.getJSON(a.url,C,function(a){if(u=0,0!=v.input_queue.length&&r){var c=datasCheck(a);c!==!1&&(e=c,q[b]=e,H())}})):(e=q[b],H())):H()},F=function(){init(b);var a=g<e.length?g:e.length,c=0,d=v.val(),f=!1;for(z in e){if(!(a>c)){f=!0;break}var j=e[z];if(s&&i)n&&""!=d?-1!==j.text.indexOf(d)&&(G(j,c),c++):(G(j,c),c++);else if(m&&""!=d){var k=j.text.toLowerCase(),l=d.toLowerCase();-1!==k.indexOf(l)&&(G(j,c),c++)}else G(j,c),c++}if(f&&""!=h&&(v.html=v.html+"<li more-data-tip='1'>"+h+"</li>"),""!=v.html){var o=v.offset(),p=o.left,q=o.top+v.outerHeight()+5;v.html="<ul id='"+A+"' class='input-match-box' onmouseleave='moveOnInputMatchBox("+b+",0)' onmouseenter='moveOnInputMatchBox("+b+",1)' style='position:absolute;top:"+q+"px;left:"+p+"px'>"+v.html+"</ul>",$("body").append(v.html)}s=!1},G=function(a,c){var d=v.val();if(d==a.text&&""===v.current_match_item_position){var e='class="on"';v.current_match_item_position=v.select_item_position=c}else var e="";var f=0==c?'style="border:none"':"";v.html=v.html+"<li "+e+' onclick="inputMatchItemSelect('+b+",'"+a.value+"','"+a.text+"','"+p+'\')" onmouseover="moveOverInputMatchItem('+b+',$(this))" value-v="'+a.value+'" '+f+">"+a.text+"</li>"},H=function(){if(f>0){var b=D();if(void 0!=a.data||void 0==a.url||o||void 0==q[b]){var c=(new Date).getTime();c-t>=f?I():setTimeout(function(){H()},50)}else e=q[b],F()}else I()},I=function(){v.input_queue.length>v.input_queue_length?1==u?setTimeout(function(){H()},50):E():F()};this.keydown(function(a){return 13==a.keyCode?(a.preventDefault(),a.stopPropagation(),!1):void 0}),this.keyup(function(c){if(13==c.keyCode)""!==v.select_item_position&&inputMatchItemSelect(b,$(".input-match-box li").eq(v.select_item_position).attr("value-v"),$(".input-match-box li").eq(v.select_item_position).text(),p);else if(38==c.keyCode||40==c.keyCode)moveSelectInputMatchItem(b,c.keyCode);else if($(".input-match-box").length>0&&$(".input-match-box").hide(),t=(new Date).getTime(),void 0!=a.data)v.input_queue.push(v.val()),1==v.input_queue.length&&H();else if(void 0!=a.url&&""!=a.url)if(v.input_queue.push(v.val()),1==v.input_queue.length)H();else{var d=D();void 0!=a.data||void 0==a.url||o||void 0==q[d]||(e=q[d],F())}return c.preventDefault(),c.stopPropagation(),!1}),this.focus(function(b){s=!0,r=!0,i&&(void 0!=a.data?(v.input_queue.push(v.val()),H()):void 0!=a.url&&""!=a.url&&(v.input_queue.push(v.val()),H()))}),this.blur(function(a){r=!1,v.on_match_box||(j&&(e.length>0&&B()||v.val("")),init(b))})};var count=-1,objects=[],current_object="";window.moveSelectInputMatchItem=function(a,b){if(getCurrentObject(a),$(".input-match-box").length>0&&(38==b||40==b)){var d=$(".input-match-box li").length-1,e=""===current_object.select_item_position?0:38==b?current_object.select_item_position-1:current_object.select_item_position+1;void 0==$(".input-match-box li").eq(e).attr("more-data-tip")&&(e=0>e?0:e>d?d:e,moveOverInputMatchItem(a,$(".input-match-box li").eq(e)))}},window.moveOnInputMatchBox=function(a,b){getCurrentObject(a),1==b?current_object.on_match_box=!0:(current_object.on_match_box=!1,current_object.fillRightNow||(current_object.select_item_position=current_object.current_match_item_position,$(".input-match-box li").removeClass("on"),""!==current_object.current_match_item_position&&$(".input-match-box li").eq(current_object.current_match_item_position).addClass("on")))},window.moveOverInputMatchItem=function(a,b){getCurrentObject(a),$(".input-match-box li").removeClass("on"),b.addClass("on"),current_object.select_item_position=$(".input-match-box li").index(b),current_object.fillRightNow&&(current_object.current_match_item_position=current_object.select_item_position,current_object.val(b.text()))},window.inputMatchItemSelect=function(obj_count,value,text,callback){getCurrentObject(obj_count),current_object.val(text),init(obj_count),current_object.blur(),""!=callback&&eval(callback+"('"+value+"','"+text+"')")}}(jQuery);